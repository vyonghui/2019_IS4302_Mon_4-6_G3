<!DOCTYPE html>
<html>
<head>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet">
      <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Open+Sans" />
      <!--jquery-->
<script type="text/javascript" src="https://code.jquery.com/jquery-1.12.4.js"></script>
<!--datatables-->
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.16/css/jquery.dataTables.min.css">
<script type="text/javascript" src="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js"></script>
<style>
    * {
       font-family: "Open Sans";
        color:white; }
 .top-nav {
height:60px;
background-color:#202020  ;
z-index:10;
  position: absolute;
  top:0;
  left:0;
  width:100%;
  padding:10px;
 }


.nav-link {
    float:right;
    color:white;
    padding:3px 30px ;
}
.sidenav {
  height: 100%;
  width: 200px;
  position: fixed;
  z-index: -1;
padding-left:10px;
padding-top:60px;
  top: 0px;
  left: 0;
  background-color: #111;
  overflow-x: hidden;
  transition: 0.5s;
  font-size:1px
}

.sidenav a {
  padding: 8px 8px 8px 20px;
  text-decoration: none;
  font-size: 10px;
  color: #818181;
  display: block;
  transition: 0.3s;
}

.sidenav a:hover {
  color: #f1f1f1;
}

.sidenav .closebtn {
  position: absolute;
  top: 0;
  right: 25px;
  font-size: 36px;
  margin-left: 50px;
}

@media screen and (max-height: 450px) {
  .sidenav {padding-top: 15px;}
  .sidenav a {font-size: 18px;}
}
.left-nav-open {
    font-size:30px;
    cursor:pointer;
    color:white;
    font-size: 20px;
    margin-left:10px;
  
}

hr {
    display: block;
    height: 1px;
    border: 0;
    border-top: 1px solid #ccc;
    margin: 1em 0;
    padding: 0; 
}

.side-nav-link {
font-size: 18px;
display:inline;

}

.profile-info {
color:white;
text-align: center;
}
.profile {
    margin:20px;
      height:160px;
}

.profile-icon {
    font-size:100px;
    text-align: center;
    padding: 10px 20px;
}
.dashboard-content {
    position:absolute;
    padding-top:60px; 
    top:0px;
   
    left:200px;
  min-height:100%;
  width:85.95%;
    border-spacing:50px 20px;
    background-color:#464856;

}
.material-icons {
     position: relative;
  top: 6px;

}

#logo {
  margin-left:35px;
  margin-top:3px;
}
.advertisement {
   
    
}
.image-ads {
    width:100%;
    
    
}
#my-coe, #unused-coe, #pending-coe    {
    padding-left: 50px; 
    padding-top: 30px;
   width:90%;
}

.coe-info {

     background-color:#FAF9FA;

     background-position: 9px 0px;
     background-repeat: no-repeat;
    
     border-radius: 6px;
     line-height: 18px;
     overflow: hidden;
    padding: 30px 50px;
     margin:40px;
     height:50px;
     width:1000px;
       
        border:solid 2px #606060;
        text-align:center;
}

table {
    padding:50px;
color:white;
  text-align: center;
font-size:12px;
  border-collapse: collapse;
  width: 100%;
  background-color:#202020;
 
}
th {
 
}
td, th {
 
 
  padding: 8px;
   border-bottom: 1px solid #aaaaaa;
}

tr:nth-child(even) {
   
background-color:#a88a05;
}
  .transction-buttons {
      box-shadow: inset 0px 1px 0px 0px #fff6af;

      background: linear-gradient(to bottom, #FAF9FA 5%, #ffab23 100%);
      filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#ffec64', endColorstr='#ffab23', GradientType=0);
      background-color: #a88a05;

      border-radius: 6px;
      border: 1px solid #ffaa22;
      display: inline-block;
      cursor: pointer;
      color: #333333;


      text-decoration: none;
      text-shadow: 0px 1px 0px #ffee66;

      padding: 5px 10px;
      margin-left:50px;
    }

  .modal {

      display: none;
      /* Hidden by default */
      position: fixed;
      /* Stay in place */
      z-index: 1;
      /* Sit on top */
      padding-top: 100px;
      /* Location of the box */
      left: 100px;
      top: 0;
      width: 100%;
      /* Full width */
      height: 100%;
      /* Full height */
      overflow: auto;
      /* Enable scroll if needed */
      background-color: rgb(0, 0, 0);
      /* Fallback color */
      background-color: rgba(0, 0, 0, 0.4);
      /* Black w/ opacity */

    }

    /* Modal Content */
    .modal-content {
      background-color: #202020;
      margin: auto;
      padding: 20px;
      border: 1px solid #888;
      width: 80%;
    }
 .loader {
  position: relative;
  text-align: center;
  margin: 300px 650px;
  z-index: 9999;
  display: block;
  width: 80px;
  height: 80px;
  border: 10px solid rgba(0, 0, 0, .3);
  border-radius: 50%;
  border-top-color: #000;
  animation: spin 1s ease-in-out infinite;
  -webkit-animation: spin 1s ease-in-out infinite;
}
.modal-popup{
  display:none;
  width:100%;
  height:100%;
  position:fixed;
  left:0;
  top:0;
  background-color:rgb(255,255,255,50%);
 
  z-index:9999;
}
@keyframes spin {
  to {
    -webkit-transform: rotate(360deg);
  }
}

@-webkit-keyframes spin {
  to {
    -webkit-transform: rotate(360deg);
  }
}
</style>
</head>
<body>

<div class="top-nav">
  <img id="logo" src="images/logo.jpg" height="40px"></img>
    <h6 style="cursor:pointer"onclick="logout()" class="nav-link">Logout</h6>
<a href="/dashboard" class="nav-link">MyDashboard</a>
</div>

<div id="mySidenav" class="sidenav">
<div class="profile">
<i class="material-icons profile-icon">account_circle</i>
  <h6 class="profile-info">Logged In As: <br><b><p style="margin:5px" id="username"></p></b></h6>
   
</div>
<hr>
 <div class="sidenav-element"> <a href="cars"><i class="material-icons">time_to_leave</i> <p class="side-nav-link">&nbsp;&nbsp;Cars</p></a>
  </div><hr>
  <div class="sidenav-element"><a href="coe"> <i class="material-icons">bookmarks</i> <p class="side-nav-link">&nbsp;&nbsp;COE</p></a>
  </div><hr>  
  <div class="sidenav-element"><a href="insurance"><i class="material-icons">description</i> <p class="side-nav-link">&nbsp;&nbsp;Insurance</p> </a>
  </div><hr>

</div>

<div class="dashboard-content">
   <div id="unused-coe">

   


</div>
 <div id="pending-coe">

   


</div>
    <div id="my-coe">

   


</div>

    </div>
      <div id="apply-coe" class="modal">

      <div class="modal-content">
        <span class="close-sale">
          <h3 style="color:#a88a05;display:inline">Apply For COE</h3>&nbsp;&times;
        </span>

        <div id="my-cars-sale">

        </div>
          COE ID: <input style="color:black;" type="text" id="coeId" name="coeId" />
    
       <label  for="category">Category &nbsp; &nbsp; &nbsp;</label>
    <select style="color:black" id="category" name="category">
      <option value="A">A</option>
      <option value="B">B</option>
      <option value="C">C</option>
       <option value="D">D</option>
        <option value="E">E</option>
    </select>
         <br>
        <input style="color:black;" type="submit" value="Submit Application" onclick="submitApplication()" />

      </div>

    </div>
      <div class="modal-popup " id="loadMe" tabindex="-1">
        <div class="loader"></div>
        <div clas="loader-txt">
        </div>
</div> 

     <script type="text/javascript">
 var modal = document.getElementById('loadMe');
function submitApplication() {
  

   
     modal.style.backdrop = ('static');
      modal.style.keyboard = ('false');
  modal.style.display = ('block');

 const coeId = $('#coeId').val();
       const category = $('#category').val();
         let currentUser;
   $.ajax({
        url: "/" + localStorage.username + "/api/system/ping",
        async: false,
        success: (function (data) {
          currentUser = data.participant;
        }),
      })
         $.ajax({
        method: "POST",
        url: "/" + localStorage.username + "/api/org.nus.carnetwork.COE",


        data: {
          "$class": "org.nus.carnetwork.COE",
          "coeId": coeId,
  "expiryDate": new Date(new Date().setFullYear(new Date().getFullYear() + 1)),
  "coeCategory": category,
  "documentStatus": "PENDING",
  "owner": currentUser,


        }

        //success: updatePage,
        //error:  error
      }).done(function (msg) {
           modal.style.display = ('none');
        alert('Application submitted!');

        location.reload();
      }).fail(function (error) {

        console.log(error);
      })
}
  function logout() {
 localStorage.removeItem('username');

                
                      $.ajax({
    method: "POST",
            url: "/logout",

        
        }).done(function (data) {
          console.log("DONE");
          
          window.location.replace("/login");
            }).fail(function (error) {
   console.log(error.responseText)
  })
  }

    var applyCOEModal = document.getElementById("apply-coe");

   
    window.onclick = function (event) {
      if (event.target == applyCOEModal) {
        applyCOEModal.style.display = "none";
      }
    }
function applyCOE() {
   applyCOEModal.style.display = "block";
}
    $(document).ready(function () {
document.getElementById('username').innerHTML = localStorage.username;
        let myCOEs = [];
        $.ajax({
            url: "/" + localStorage.username +"/api/org.nus.carnetwork.COE"
        }).done(function (data) {
            data.forEach(function (coe) {
                myCOEs.push(coe);
            });
              $('#my-coe').html(function() {
      
var output = 'My COE: ';
     output +=   '<hr> <table> <th>COE ID</th>    <th>Expiry Date</th>    <th>Category</th>    <th>Status</th>      <th>Car Plate Number</th>';

            	for (var i = 0; i < myCOEs.length; i++) {
        if ((myCOEs[i].car && myCOEs[i].car.substring(32)  != '')|| myCOEs[i].documentStatus == "REJECTED") {
   output +="<tr>"
   output +=" <td>"+myCOEs[i].coeId+"</td>";
output +="    <td>"+myCOEs[i].expiryDate.substring(0,10)+"</td>";
  output +=  "<td>"+myCOEs[i].coeCategory+"</td>";
 output +=   "<td>"+myCOEs[i].documentStatus+"</td>";
 if (myCOEs[i].car){
  output +=   "<td>"+myCOEs[i].car.substring(32)+"</td>";
 }  else {
   output +=   "<td></td>";
 }
output +='</tr>';
        }
              }
              output += "</table>";
              return output;
                    })
                      $('#unused-coe').html(function() {
      
var output = 'Unused COE: <div onclick="applyCOE()" class="transction-buttons"><h6 class="box-info"><b style="color:black;">Apply For COE</b></h6></div>';
     output +=   '<hr> <table> <th>COE ID</th>    <th>Expiry Date</th>    <th>Category</th>    <th>Status</th>      <th>Car Plate Number</th>';

            	for (var i = 0; i < myCOEs.length; i++) {
        if (myCOEs[i].car && myCOEs[i].car.substring(32)  != '') {

        } else if (myCOEs[i].documentStatus == "VERIFIED") {
             output +="<tr>"
   output +=" <td>"+myCOEs[i].coeId+"</td>";
output +="    <td>"+myCOEs[i].expiryDate.substring(0,10)+"</td>";
  output +=  "<td>"+myCOEs[i].coeCategory+"</td>";
 output +=   "<td>"+myCOEs[i].documentStatus+"</td>";
 if (myCOEs[i].car){
  output +=   "<td>"+myCOEs[i].car.substring(32)+"</td>";
 }  else {
   output +=   "<td></td>";
 }
output +='</tr>';
        }
              }
              output += "</table>";
              return output;
                    })
                        $('#pending-coe').html(function() {
      
var output = 'Pending COE: ';
     output +=   '<hr> <table> <th>COE ID</th>    <th>Expiry Date</th>    <th>Category</th>    <th>Status</th>      <th>Car Plate Number</th>';

            	for (var i = 0; i < myCOEs.length; i++) {
        if (myCOEs[i].documentStatus == "PENDING") {

        
             output +="<tr>"
   output +=" <td>"+myCOEs[i].coeId+"</td>";
output +="    <td>"+myCOEs[i].expiryDate.substring(0,10)+"</td>";
  output +=  "<td>"+myCOEs[i].coeCategory+"</td>";
 output +=   "<td>"+myCOEs[i].documentStatus+"</td>";
 if (myCOEs[i].car){
  output +=   "<td>"+myCOEs[i].car.substring(32)+"</td>";
 }  else {
   output +=   "<td></td>";
 }
output +='</tr>';
        }
              }
              output += "</table>";
              return output;
                    })
        });


                }
            
        );
  
</script>
    </body>
    </html>